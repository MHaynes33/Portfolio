---
import PageLayout from "../layouts/PageLayout.astro";

// Temporary project list; we will fill real content in the next step.
const projects = [
  { id: "credit-risk", title: "Credit-Risk Dashboard 2.0" },
  { id: "scra",        title: "SCRA Re-amortization" },
  { id: "ops-cost",    title: "Operational Cost Optimization" },
  { id: "warehouse",   title: "Data Warehouse POC" },
];
---

<!-- Local styles for layout + themes -->
<style>
  :root {
    --bg: #ffffff;
    --fg: #0f172a;
    --muted: #64748b;
    --accent: #1a73e8;
  }
  [data-theme="hero"]    { --bg:#0b0f1a; --fg:#e6eefc; --muted:#b3c0d6; }  /* deep navy hero */
  [data-theme="about"]   { --bg:#111524; --fg:#e6eefc; --muted:#a7b5cc; }
  [data-theme="sand"]    { --bg:#f4f2ef; --fg:#0f172a; --muted:#6b7280; }  /* sandy cards */
  [data-theme="slate"]   { --bg:#0b0c10; --fg:#e5e7eb; --muted:#9ca3af; }  /* near-black */
  [data-theme="contact"] { --bg:#0b0f1a; --fg:#e6eefc; --muted:#b3c0d6; }

  html { scroll-behavior:smooth; background: var(--bg); color: var(--fg); }
  @media (prefers-reduced-motion: reduce) { html { scroll-behavior:auto; } }

  /* Left rail */
  .rail { position:fixed; inset:0 auto 0 0; width:76px; display:flex; flex-direction:column; align-items:center; gap:18px; padding:18px 0; z-index:40; }
  .rail a { color:var(--muted); text-decoration:none; }
  .rail a:hover { opacity:.75; }
  .rail .proj { writing-mode:vertical-rl; transform:rotate(180deg); font-size:12px; letter-spacing:.04em; }
  .grow { flex:1 1 auto; }

  /* Content offset */
  .content { padding-left:86px; }

  /* Sections */
  .section { min-height:100vh; display:grid; align-items:center; }
  .container { width:100%; max-width:1200px; margin:0 auto; padding:0 1.5rem; }
  .container { transition: color .35s ease, background-color .35s ease; }
  .h1 { font-size:clamp(2.75rem, 6vw, 5rem); line-height:.95; font-weight:600; letter-spacing:-.01em; }
  .h2 { font-size:clamp(1.25rem, 3vw, 2.25rem); color:var(--muted); }
  .lead { font-size:1.125rem; color:var(--muted); max-width:52ch; }
  .btn { display:inline-block; padding:.75rem 1.25rem; border-radius:.5rem; border:1px solid currentColor; }
  .btn-primary { background:#0f172a; color:#fff; border-color:#0f172a; }
  .btn-outline { color:var(--fg); }
  .grid2 { display:grid; grid-template-columns:1fr; }
  @media (min-width: 980px) { .grid2 { grid-template-columns:1fr 1fr; } }

  /* Active state for scrollspy */
  .is-active { color: var(--accent); font-weight:600; }

  /* Smooth theme transition */
  body { transition: background-color .35s ease, color .35s ease; }
  /* Focus ring used when navigating from the left rail for accessibility */
  .ring-rail:focus-visible {
    outline: none;
    box-shadow: 0 0 0 4px rgba(26,115,232,0.16);
    border-radius: .25rem;
  }
</style>

<PageLayout>

  <!-- LEFT RAIL: socials + project list -->
  <aside class="rail" aria-label="Side navigation">
    <div class="flex flex-col items-center gap-3 mt-2">
  <a href="mailto:mikehaynes357@gmail.com" aria-label="Email">@</a>
      <a href="https://www.linkedin.com/in/mikehaynes" target="_blank" rel="noopener" aria-label="LinkedIn">in</a>
      <a href="https://github.com/MHaynes33" target="_blank" rel="noopener" aria-label="GitHub">gh</a>
    </div>
    <div class="grow"></div>
    <nav class="flex flex-col items-center gap-6 mb-4" aria-label="Projects">
      {projects.map(p => (<a class="proj" href={`#${p.id}`} data-spy-link>{p.title}</a>))}
      <a class="proj" href="#contact" data-spy-link>Contact</a>
    </nav>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="content">

    <!-- HERO -->
    <section id="home" class="section pt-24 lg:pt-28" data-theme="hero" data-spy-section>
      <div class="container">
        <p style="color:var(--muted); margin-bottom:.5rem;">2025</p>
        <h1 class="h1" style="font-size:clamp(3rem, 8vw, 6rem); line-height:.92;">Mike Haynes</h1>
        <h2 class="h2" style="font-size:clamp(1rem, 2.6vw, 1.9rem); font-weight:400; margin-top:.25rem; color:var(--muted);">Business Intelligence · Operational Strategy · Decision Systems</h2>
        <p class="lead" style="margin-top:1.25rem;">
          Builds clear decision systems. Turns messy data into reliable operations.
        </p>
        <div style="margin-top:3rem; margin-bottom:3rem; display:flex; gap:1rem;">
          <a href="#credit-risk" class="btn btn-primary">View projects</a>
          <a href="/resume.pdf" class="btn btn-outline">Download résumé</a>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="about" class="section" data-theme="about" data-spy-section>
      <div class="container">
        <h3 class="h2" style="color:var(--fg);">About</h3>
        <p class="lead" style="margin-top:.75rem;">
          Senior BI and data analyst who ships operational tooling leaders actually use. SQL, Power BI, DAX, Python. Architecture that surfaces risk early and removes noise.
        </p>
      </div>
    </section>

    <!-- PROJECT SECTIONS (stubs; we will enrich next step) -->
    {projects.map((p, idx) => (
      <section id={p.id} class="section" data-theme={(idx % 2 === 0) ? 'sand' : 'slate'} data-spy-section>
        <div class="container grid2" style="gap:0; align-items:center;">
          {
            /* For even-index sections show visual column first (visual left, text right) */
            (idx % 2 === 0) ? (
              <>
                <div style="padding:1rem; display:grid; place-items:center;">
                  <div class="rounded-xl overflow-hidden" style="width:100%; max-width:960px; aspect-ratio:16/9; background:var(--bg); box-shadow: inset 0 12px 30px rgba(2,6,23,0.06);">
                    <!-- masked visual placeholder -->
                    <div style="width:100%; height:100%; background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.04));"></div>
                  </div>
                </div>

                <div style="padding:2rem 1.5rem 2rem 1.5rem;">
                  <p style="color:var(--muted); margin-bottom:.25rem;">{(idx % 2 === 0) ? '2019–2025' : '2024–2025'} &bull; {p.id.replace('-', ' ')}</p>
                  <h3 class="h1" style="font-size:clamp(2rem,4vw,3.25rem)">{p.title}</h3>
                  <p class="lead" style="margin-top:1rem; max-width:66ch;">Short summary placeholder. We will add outcomes, metrics, and artifacts in the next step.</p>
                </div>
              </>
            ) : (
              /* odd-index sections keep text left, visual right */
              <>
                <div style="padding:2rem 1.5rem 2rem 1.5rem;">
                  <p style="color:var(--muted); margin-bottom:.25rem;">{(idx % 2 === 0) ? '2019–2025' : '2024–2025'} &bull; {p.id.replace('-', ' ')}</p>
                  <h3 class="h1" style="font-size:clamp(2rem,4vw,3.25rem)">{p.title}</h3>
                  <p class="lead" style="margin-top:1rem; max-width:66ch;">Short summary placeholder. We will add outcomes, metrics, and artifacts in the next step.</p>
                </div>

                <div style="padding:1rem; display:grid; place-items:center;">
                  <div class="rounded-xl overflow-hidden" style="width:100%; max-width:960px; aspect-ratio:16/9; background:var(--bg); box-shadow: inset 0 12px 30px rgba(2,6,23,0.06);">
                    <!-- masked visual placeholder -->
                    <div style="width:100%; height:100%; background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.04));"></div>
                  </div>
                </div>
              </>
            )
          }
        </div>
      </section>
    ))}

    <!-- CONTACT -->
    <section id="contact" class="section" data-theme="contact" data-spy-section>
      <div class="container">
        <h3 class="h2" style="color:var(--fg);">Contact</h3>
        <p class="lead" style="margin-top:.75rem;">Best way to reach me is email or LinkedIn.</p>
        <div style="margin-top:1rem; display:flex; gap:1.25rem; font-size:1.1rem;">
          <a href="mailto:mikehaynes357@gmail.com" class="btn btn-outline">mikehaynes357@gmail.com</a>
          <a href="https://www.linkedin.com/in/mikehaynes" target="_blank" rel="noopener" class="btn btn-outline">LinkedIn</a>
          <a href="https://github.com/MHaynes33" target="_blank" rel="noopener" class="btn btn-outline">GitHub</a>
        </div>
      </div>
    </section>

  </main>
</PageLayout>

<!-- Scrollspy + Theme switcher -->
<script>
  // Progressive enhancement only
  const sections = Array.from(document.querySelectorAll('[data-spy-section]'));
  const links = Array.from(document.querySelectorAll('[data-spy-link]'));

  // Helper: set active link by hash
  function setActive(id) {
    links.forEach(a => {
      const match = a.getAttribute('href') === ('#' + id);
      a.classList.toggle('is-active', match);
      if (match) a.setAttribute('aria-current','true'); else a.removeAttribute('aria-current');
    });
  }

  // Helper: apply theme from section
  function applyTheme(section) {
    const theme = section.getAttribute('data-theme') || 'hero';
    // Flip root CSS variables by toggling a data attribute on <body>
    document.body.setAttribute('data-theme', theme);
    // Mirror variables onto body to actually change bg/fg colors
    const styles = getComputedStyle(section);
    document.documentElement.style.backgroundColor = styles.getPropertyValue('--bg');
    document.documentElement.style.color = styles.getPropertyValue('--fg');
  }

  // Intersection Observer for scrollspy + theme shift
  const obs = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting && entry.intersectionRatio > 0.55) {
        const id = entry.target.id;
        setActive(id);
        applyTheme(entry.target);
        history.replaceState(null, '', '#' + id); // passive hash update
      }
    });
  }, { threshold: [0, 0.55, 1] });

  sections.forEach(sec => obs.observe(sec));

  // On load, set based on current hash or first section
  window.addEventListener('load', () => {
    const current = document.getElementById(location.hash.replace('#','')) || sections[0];
    if (current) { setActive(current.id); applyTheme(current); }
  });

  // When a rail link is clicked, smooth-scroll to section and focus its first heading for accessibility
  links.forEach((a) => {
    if (a.closest('.rail')) {
      a.addEventListener('click', (ev) => {
        ev.preventDefault();
        const href = a.getAttribute('href') || '';
        const id = href.startsWith('#') ? href.slice(1) : null;
        if (!id) return;
        const target = document.getElementById(id);
        if (!target) return;
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        const heading = target.querySelector('h1,h2,h3,h4');
        if (heading) {
          // make focusable and add visual ring class
          heading.setAttribute('tabindex', '-1');
          heading.classList.add('ring-rail');
          (heading as HTMLElement).focus();
          // cleanup after blur
          heading.addEventListener('blur', () => {
            heading.removeAttribute('tabindex');
            heading.classList.remove('ring-rail');
          }, { once: true });
        }
      });
    }
  });
</script>